import React, { useState, useMemo, useRef, useEffect } from 'react'
import { useNavigate } from 'react-router-dom'
import { 
  BookOpen, 
  Play, 
  Users, 
  User, 
  Clock, 
  Star, 
  Filter, 
  Search, 
  Grid, 
  List,
  Calendar,
  Video,
  FileText,
  Award,
  Download,
  Eye,
  ShoppingCart,
  Heart,
  Bookmark,
  CheckCircle,
  PlayCircle,
  Target,
  Zap,
  Timer,
  TrendingUp,
  Trophy,
  ExternalLink,
  Lightbulb,
  Youtube,
  Send,
  BarChart3,
  Brain,
  Headphones,
  MessageSquare,
  PenTool,
  Globe,
  Pause,
  Volume2,
  VolumeX,
  Maximize,
  SkipBack,
  SkipForward,
  Settings,
  Subtitles,
  Save,
  Edit3,
  Trash2,
  Plus,
  BookmarkPlus,
  Highlighter,
  Type,
  Languages,
  Copy,
  Share2,
  RotateCcw,
  FastForward,
  Rewind
} from 'lucide-react'
import { courses } from '../../mock/courses'
import { books, bookCategories, bookLevels, bookFilters as bookFilterOptions } from '../../mock/books'
import { practiceTests, studyTips, tutorials, connectedSites } from '../../mock/practice'
import toast from 'react-hot-toast'

// Mock data for video lessons
// Mock video lessons for LMS (EN learning)
// - giữ field cũ: id, title, duration, thumbnail, videoUrl, description, courseId, completed, notes, subtitles
// - bổ sung tiện ích: durationSec, level, cefrLevel, skill, tags, progress, chapters, resources, quizId,
//   prerequisites, relatedLessonIds, subtitleTracks (đa ngôn ngữ)
export const videoLessons = [
  {
    id: 1,
    courseId: 1, // Grammar Foundation
    title: "Introduction to English Grammar",
    description: "Learn the core parts of speech and basic sentence structure.",
    skill: "grammar",
    level: "beginner",
    cefrLevel: "A1",
    tags: ["parts of speech", "sentence basics"],
    duration: "15:30",
    durationSec: 930,
    thumbnail: "/api/placeholder/300/200?text=Grammar+Intro",
    // Dùng link mẫu ổn định; thay bằng CDN nội bộ khi triển khai
    videoUrl: "https://www.w3schools.com/html/mov_bbb.mp4",
    completed: false,
    progress: 0.12,
    chapters: [
      { title: "Welcome & goals", start: 0 },
      { title: "Parts of speech", start: 75 },
      { title: "Simple sentences", start: 420 },
      { title: "Wrap-up", start: 870 }
    ],
    notes: [],
    subtitles: [
      { start: 0, end: 5, text: "Welcome to English Grammar basics." },
      { start: 5, end: 10, text: "Today we'll learn about sentence structure." }
    ],
    subtitleTracks: [
      { lang: "en", label: "English", kind: "subtitles" },
      { lang: "vi", label: "Tiếng Việt", kind: "subtitles" }
    ],
    resources: {
      slidesUrl: "/files/grammar-intro-slides.pdf",
      worksheetUrl: "/files/grammar-intro-worksheet.pdf",
      transcriptUrl: "/files/grammar-intro-transcript.txt"
    },
    quizId: 101,
    prerequisites: [],
    relatedLessonIds: [2, 4]
  },
  {
    id: 2,
    courseId: 1,
    title: "Present Simple vs. Present Continuous",
    description: "Usage, signal words, and common mistakes.",
    skill: "grammar",
    level: "beginner",
    cefrLevel: "A2",
    tags: ["present tenses", "usage"],
    duration: "12:45",
    durationSec: 765,
    thumbnail: "/api/placeholder/300/200?text=Present+Tenses",
    videoUrl: "https://www.w3schools.com/html/movie.mp4",
    completed: true,
    progress: 1,
    chapters: [
      { title: "Form & meaning", start: 0 },
      { title: "Signal words", start: 210 },
      { title: "Common mistakes", start: 520 }
    ],
    notes: [],
    subtitles: [
      { start: 0, end: 5, text: "Present tense is used for current actions." },
      { start: 5, end: 10, text: "Let's see some examples." }
    ],
    subtitleTracks: [{ lang: "en", label: "English", kind: "subtitles" }],
    resources: {
      slidesUrl: "/files/present-tenses-slides.pdf",
      worksheetUrl: "/files/present-tenses-exercises.pdf",
      transcriptUrl: "/files/present-tenses-transcript.txt"
    },
    quizId: 102,
    prerequisites: [1],
    relatedLessonIds: [3]
  },
  {
    id: 3,
    courseId: 1,
    title: "Past Simple Basics",
    description: "Regular vs. irregular verbs and timelines.",
    skill: "grammar",
    level: "beginner",
    cefrLevel: "A2",
    tags: ["past simple", "irregular verbs"],
    duration: "11:20",
    durationSec: 680,
    thumbnail: "/api/placeholder/300/200?text=Past+Simple",
    videoUrl: "https://www.w3schools.com/html/mov_bbb.mp4",
    completed: false,
    progress: 0.05,
    chapters: [
      { title: "When to use", start: 0 },
      { title: "Regular vs irregular", start: 180 },
      { title: "Practice", start: 460 }
    ],
    notes: [],
    subtitles: [],
    subtitleTracks: [{ lang: "en", label: "English", kind: "subtitles" }],
    resources: {
      slidesUrl: "/files/past-simple-slides.pdf",
      worksheetUrl: "/files/past-simple-exercises.pdf",
      transcriptUrl: "/files/past-simple-transcript.txt"
    },
    quizId: 103,
    prerequisites: [1],
    relatedLessonIds: [2, 4]
  },
  {
    id: 4,
    courseId: 1,
    title: "Articles & Determiners",
    description: "a/an, the, and when to use zero article.",
    skill: "grammar",
    level: "intermediate",
    cefrLevel: "B1",
    tags: ["articles", "definite/indefinite"],
    duration: "14:05",
    durationSec: 845,
    thumbnail: "/api/placeholder/300/200?text=Articles",
    videoUrl: "https://www.w3schools.com/html/movie.mp4",
    completed: false,
    progress: 0,
    chapters: [
      { title: "Overview", start: 0 },
      { title: "a/an vs the", start: 240 },
      { title: "Zero article", start: 540 }
    ],
    notes: [],
    subtitles: [],
    resources: { slidesUrl: "/files/articles-slides.pdf" },
    quizId: 104,
    prerequisites: [1],
    relatedLessonIds: [2, 3]
  },

  // Vocabulary Builder
  {
    id: 5,
    courseId: 2, // Vocabulary
    title: "Advanced Vocabulary Building",
    description: "Expand your English vocabulary effectively with chunks & collocations.",
    skill: "vocabulary",
    level: "intermediate",
    cefrLevel: "B1",
    tags: ["collocations", "word families"],
    duration: "18:20",
    durationSec: 1100,
    thumbnail: "/api/placeholder/300/200?text=Vocab+Advanced",
    videoUrl: "https://www.w3schools.com/html/mov_bbb.mp4",
    completed: false,
    progress: 0.2,
    chapters: [
      { title: "Why collocations", start: 0 },
      { title: "Practice with chunks", start: 420 },
      { title: "Review & homework", start: 980 }
    ],
    notes: [],
    subtitles: [],
    resources: {
      slidesUrl: "/files/vocab-advanced-slides.pdf",
      worksheetUrl: "/files/vocab-advanced-exercises.pdf"
    },
    quizId: 201,
    prerequisites: [],
    relatedLessonIds: [6]
  },
  {
    id: 6,
    courseId: 2,
    title: "Academic Word List: Sublist 1",
    description: "High-frequency academic words with examples.",
    skill: "vocabulary",
    level: "intermediate",
    cefrLevel: "B2",
    tags: ["AWL", "academic"],
    duration: "16:10",
    durationSec: 970,
    thumbnail: "/api/placeholder/300/200?text=AWL+1",
    videoUrl: "https://www.w3schools.com/html/movie.mp4",
    completed: false,
    progress: 0,
    chapters: [
      { title: "Overview & strategy", start: 0 },
      { title: "Top 20 words", start: 240 },
      { title: "Context practice", start: 720 }
    ],
    notes: [],
    subtitles: [],
    resources: { slidesUrl: "/files/awl1-slides.pdf", worksheetUrl: "/files/awl1-exercises.pdf" },
    quizId: 202,
    prerequisites: [5],
    relatedLessonIds: [7]
  },
  {
    id: 7,
    courseId: 2,
    title: "Phrasal Verbs in Daily Life",
    description: "Common phrasal verbs with do/get/go/make.",
    skill: "vocabulary",
    level: "intermediate",
    cefrLevel: "B1",
    tags: ["phrasal verbs", "speaking"],
    duration: "10:55",
    durationSec: 655,
    thumbnail: "/api/placeholder/300/200?text=Phrasal+Verbs",
    videoUrl: "https://www.w3schools.com/html/mov_bbb.mp4",
    completed: false,
    progress: 0,
    chapters: [
      { title: "Meaning & patterns", start: 0 },
      { title: "Dialog practice", start: 270 }
    ],
    notes: [],
    subtitles: [],
    resources: { worksheetUrl: "/files/phrasal-verbs-practice.pdf" },
    quizId: 203,
    prerequisites: [],
    relatedLessonIds: [5, 6]
  },

  // Skills: Listening / Speaking / Pronunciation / Writing
  {
    id: 8,
    courseId: 3, // Listening & Speaking
    title: "Listening: Short Dialogues (A2)",
    description: "Strategies for gist and detail questions.",
    skill: "listening",
    level: "beginner",
    cefrLevel: "A2",
    tags: ["listening", "strategies"],
    duration: "09:40",
    durationSec: 580,
    thumbnail: "/api/placeholder/300/200?text=Listening+A2",
    videoUrl: "https://www.w3schools.com/html/movie.mp4",
    completed: false,
    progress: 0.35,
    chapters: [
      { title: "Gist vs detail", start: 0 },
      { title: "Practice set 1", start: 220 },
      { title: "Review", start: 520 }
    ],
    notes: [{ id: "n1", userId: "u1", t: 245, text: "Key words: price, schedule" }],
    subtitles: [],
    resources: { worksheetUrl: "/files/listening-a2-set1.pdf" },
    quizId: 301,
    prerequisites: [],
    relatedLessonIds: [9]
  },
  {
    id: 9,
    courseId: 3,
    title: "Speaking: Self-Introductions",
    description: "Framework + pronunciation tips for natural introductions.",
    skill: "speaking",
    level: "beginner",
    cefrLevel: "A2",
    tags: ["speaking", "introductions", "fluency"],
    duration: "08:25",
    durationSec: 505,
    thumbnail: "/api/placeholder/300/200?text=Speaking+Intro",
    videoUrl: "https://www.w3schools.com/html/mov_bbb.mp4",
    completed: false,
    progress: 0,
    chapters: [
      { title: "Content framework", start: 0 },
      { title: "Pronunciation tips", start: 210 },
      { title: "Sample answer", start: 360 }
    ],
    notes: [],
    subtitles: [],
    resources: { slidesUrl: "/files/speaking-intro-framework.pdf" },
    quizId: 302,
    prerequisites: [],
    relatedLessonIds: [8, 10]
  },
  {
    id: 10,
    courseId: 3,
    title: "Pronunciation: English Vowel Sounds",
    description: "Minimal pairs and mouth positions.",
    skill: "pronunciation",
    level: "intermediate",
    cefrLevel: "B1",
    tags: ["minimal pairs", "vowels"],
    duration: "13:10",
    durationSec: 790,
    thumbnail: "/api/placeholder/300/200?text=Pronunciation+Vowels",
    videoUrl: "https://www.w3schools.com/html/movie.mp4",
    completed: false,
    progress: 0,
    chapters: [
      { title: "Vowel chart", start: 0 },
      { title: "Minimal pairs", start: 300 },
      { title: "Practice", start: 600 }
    ],
    notes: [],
    subtitles: [],
    resources: { worksheetUrl: "/files/vowel-minimal-pairs.pdf" },
    quizId: 303,
    prerequisites: [],
    relatedLessonIds: [9]
  },
  {
    id: 11,
    courseId: 4, // Writing
    title: "Writing: Paragraph Structure",
    description: "Topic sentence, supporting details, concluding sentence.",
    skill: "writing",
    level: "intermediate",
    cefrLevel: "B1",
    tags: ["paragraph", "cohesion"],
    duration: "12:00",
    durationSec: 720,
    thumbnail: "/api/placeholder/300/200?text=Writing+Paragraphs",
    videoUrl: "https://www.w3schools.com/html/mov_bbb.mp4",
    completed: false,
    progress: 0,
    chapters: [
      { title: "Structure overview", start: 0 },
      { title: "Model paragraph", start: 240 },
      { title: "Checklist", start: 540 }
    ],
    notes: [],
    subtitles: [],
    resources: {
      slidesUrl: "/files/writing-paragraph-structure.pdf",
      worksheetUrl: "/files/writing-paragraph-ex1.pdf"
    },
    quizId: 401,
    prerequisites: [],
    relatedLessonIds: []
  },
  {
    id: 12,
    courseId: 5, // PTE Training (sample)
    title: "PTE Speaking: Read Aloud (Demo)",
    description: "Scoring criteria and timing strategy for Read Aloud.",
    skill: "exam-skills",
    level: "intermediate",
    cefrLevel: "B2",
    tags: ["PTE", "speaking", "read aloud"],
    duration: "09:15",
    durationSec: 555,
    thumbnail: "/api/placeholder/300/200?text=PTE+Read+Aloud",
    videoUrl: "https://www.w3schools.com/html/movie.mp4",
    completed: false,
    progress: 0,
    chapters: [
      { title: "Task overview", start: 0 },
      { title: "Scoring & strategy", start: 180 },
      { title: "Live demo", start: 360 }
    ],
    notes: [],
    subtitles: [],
    resources: { worksheetUrl: "/files/pte-speaking-read-aloud.pdf" },
    quizId: 501,
    prerequisites: [8, 9],
    relatedLessonIds: []
  }
];


// Mock vocabulary dictionary
const vocabularyDictionary = {
  "grammar": {
    definition: "The set of structural rules governing the composition of clauses, phrases, and words",
    pronunciation: "/ˈɡræmər/",
    examples: ["English grammar can be challenging.", "Grammar rules help us communicate clearly."],
    synonyms: ["syntax", "structure"],
    antonyms: [],
    level: "beginner",
    partOfSpeech: "noun",
    etymology: "From Old French gramaire"
  },
  "present": {
    definition: "Existing or occurring now",
    pronunciation: "/ˈprezənt/",
    examples: ["I am present in class.", "The present situation is complex."],
    synonyms: ["current", "existing", "contemporary"],
    antonyms: ["absent", "past", "future"],
    level: "beginner",
    partOfSpeech: "adjective",
    etymology: "From Latin praesens"
  },
  "vocabulary": {
    definition: "The body of words used in a particular language",
    pronunciation: "/vəˈkæbjʊˌlɛri/",
    examples: ["Building vocabulary takes time.", "Her vocabulary is impressive."],
    synonyms: ["lexicon", "wordstock"],
    antonyms: [],
    level: "intermediate",
    partOfSpeech: "noun",
    etymology: "From Latin vocabularium"
  },
  "advanced": {
    definition: "Far on or ahead in development or progress",
    pronunciation: "/ədˈvænst/",
    examples: ["This is an advanced course.", "She has advanced skills."],
    synonyms: ["sophisticated", "complex", "developed"],
    antonyms: ["basic", "elementary", "simple"],
    level: "intermediate",
    partOfSpeech: "adjective",
    etymology: "From Old French avancier"
  }
}

const Materials = () => {
  const navigate = useNavigate()
  const [activeTab, setActiveTab] = useState('courses')
  const [courseFilter, setCourseFilter] = useState('all')
  const [bookFilters, setBookFilters] = useState({
    category: 'All Categories',
    level: 'All Levels',
    price: 'All',
    progress: 'All',
    owned: 'All'
  })
  const [searchTerm, setSearchTerm] = useState('')
  const [viewMode, setViewMode] = useState('grid')
  
  // Video player states
  const [selectedVideo, setSelectedVideo] = useState(null)
  const [isPlaying, setIsPlaying] = useState(false)
  const [currentTime, setCurrentTime] = useState(0)
  const [duration, setDuration] = useState(0)
  const [volume, setVolume] = useState(1)
  const [playbackRate, setPlaybackRate] = useState(1)
  const [showSubtitles, setShowSubtitles] = useState(true)
  const [isFullscreen, setIsFullscreen] = useState(false)
  const [showControls, setShowControls] = useState(true)
  const videoRef = useRef(null)

  // Note-taking states
  const [notes, setNotes] = useState([])
  const [currentNote, setCurrentNote] = useState('')
  const [noteTimestamp, setNoteTimestamp] = useState(0)
  const [showNoteEditor, setShowNoteEditor] = useState(false)
  const [editingNote, setEditingNote] = useState(null)
  const [noteType, setNoteType] = useState('text') // text, highlight, bookmark

  // Book reader states
  const [selectedBook, setSelectedBook] = useState(null)
  const [currentPage, setCurrentPage] = useState(1)
  const [bookmarks, setBookmarks] = useState([])
  const [highlights, setHighlights] = useState([])
  const [bookNotes, setBookNotes] = useState([])
  const [fontSize, setFontSize] = useState(16)
  const [theme, setTheme] = useState('light') // light, dark, sepia

  // Vocabulary search states
  const [vocabularySearch, setVocabularySearch] = useState('')
  const [vocabularyResults, setVocabularyResults] = useState([])
  const [savedWords, setSavedWords] = useState([])
  const [showVocabularyPanel, setShowVocabularyPanel] = useState(false)
  const [selectedWord, setSelectedWord] = useState(null)

  // Learning progress states
  const [learningProgress, setLearningProgress] = useState({
    videosWatched: 0,
    totalVideos: videoLessons.length,
    booksRead: 0,
    totalBooks: books.length,
    notesCreated: 0,
    vocabularyLearned: 0,
    studyTime: 0,
    totalPoints: 0,
    weeklyGoal: 10, // hours per week
    dailyStreak: 5
  })

  // Session tracking
  const [sessionStartTime, setSessionStartTime] = useState(Date.now())

  // Track study time
  useEffect(() => {
    const interval = setInterval(() => {
      const currentTime = Date.now()
      const sessionDuration = Math.floor((currentTime - sessionStartTime) / 1000 / 60) // minutes
      setLearningProgress(prev => ({
        ...prev,
        studyTime: prev.studyTime + (sessionDuration > 0 ? 1 : 0)
      }))
    }, 60000) // Update every minute

    return () => clearInterval(interval)
  }, [sessionStartTime])

  // Auto-save vocabulary search
  useEffect(() => {
    if (vocabularySearch.trim()) {
      const timeoutId = setTimeout(() => {
        searchVocabulary(vocabularySearch)
      }, 300)
      return () => clearTimeout(timeoutId)
    } else {
      setVocabularyResults([])
    }
  }, [vocabularySearch])
  
  // Video player functions
  const handleVideoPlay = () => {
    if (videoRef.current) {
      if (isPlaying) {
        videoRef.current.pause()
      } else {
        videoRef.current.play()
      }
      setIsPlaying(!isPlaying)
    }
  }

  const handleVideoTimeUpdate = () => {
    if (videoRef.current) {
      setCurrentTime(videoRef.current.currentTime)
    }
  }

  const handleVideoLoadedMetadata = () => {
    if (videoRef.current) {
      setDuration(videoRef.current.duration)
    }
  }

  const handleSeek = (time) => {
    if (videoRef.current) {
      videoRef.current.currentTime = time
      setCurrentTime(time)
    }
  }

  const handleVolumeChange = (newVolume) => {
    if (videoRef.current) {
      videoRef.current.volume = newVolume
      setVolume(newVolume)
    }
  }

  const handlePlaybackRateChange = (rate) => {
    if (videoRef.current) {
      videoRef.current.playbackRate = rate
      setPlaybackRate(rate)
    }
  }

  const handleSkipForward = () => {
    const newTime = Math.min(currentTime + 10, duration)
    handleSeek(newTime)
  }

  const handleSkipBackward = () => {
    const newTime = Math.max(currentTime - 10, 0)
    handleSeek(newTime)
  }

  const toggleFullscreen = () => {
    if (!document.fullscreenElement) {
      videoRef.current?.requestFullscreen()
      setIsFullscreen(true)
    } else {
      document.exitFullscreen()
      setIsFullscreen(false)
    }
  }

  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60)
    const secs = Math.floor(seconds % 60)
    return `${mins}:${secs.toString().padStart(2, '0')}`
  }

  // Note-taking functions

  const addTimestampedNote = () => {
    setNoteTimestamp(currentTime)
    setShowNoteEditor(true)
  }

  const jumpToTimestamp = (timestamp) => {
    if (selectedVideo && videoRef.current) {
      handleSeek(timestamp)
    }
  }

  // Vocabulary functions
  const searchVocabulary = (word) => {
    const results = Object.keys(vocabularyDictionary)
      .filter(key => key.toLowerCase().includes(word.toLowerCase()))
      .map(key => ({
        word: key,
        ...vocabularyDictionary[key]
      }))
    setVocabularyResults(results)
  }

  const removeWord = (wordToRemove) => {
    setSavedWords(savedWords.filter(w => w.word !== wordToRemove))
    setLearningProgress(prev => ({
      ...prev,
      vocabularyLearned: Math.max(0, prev.vocabularyLearned - 1)
    }))
    toast.success('Word removed from vocabulary!')
  }

  // Book reader functions
  const addBookmark = (page = currentPage) => {
    const bookmark = {
      id: Date.now(),
      page,
      bookId: selectedBook?.id,
      createdAt: new Date().toISOString(),
      note: ''
    }
    setBookmarks([...bookmarks, bookmark])
    toast.success(`Bookmark added for page ${page}`)
  }

  const removeBookmark = (bookmarkId) => {
    setBookmarks(bookmarks.filter(b => b.id !== bookmarkId))
    toast.success('Bookmark removed')
  }

  const addHighlight = (text, page = currentPage) => {
    const highlight = {
      id: Date.now(),
      text,
      page,
      bookId: selectedBook?.id,
      color: '#ffeb3b',
      createdAt: new Date().toISOString()
    }
    setHighlights([...highlights, highlight])
    toast.success('Text highlighted')
  }

  // Additional helper functions
  const addNote = () => {
    if (!currentNote.trim()) return

    const newNote = {
      id: Date.now(),
      content: currentNote,
      type: noteType,
      timestamp: selectedVideo ? noteTimestamp : null,
      videoId: selectedVideo?.id,
      bookId: selectedBook?.id,
      page: selectedBook ? currentPage : null,
      createdAt: new Date().toISOString()
    }

    setNotes([...notes, newNote])
    setCurrentNote('')
    setShowNoteEditor(false)
    setEditingNote(null)
    
    // Update learning progress
    const updatedProgress = { ...learningProgress }
    updatedProgress.notesTaken += 1
    updatedProgress.totalPoints += 10
    setLearningProgress(updatedProgress)
    
    toast.success('Note added successfully!')
  }

  const updateNote = () => {
    if (!currentNote.trim() || !editingNote) return

    const updatedNotes = notes.map(note => 
      note.id === editingNote.id 
        ? { ...note, content: currentNote, type: noteType }
        : note
    )
    
    setNotes(updatedNotes)
    setCurrentNote('')
    setShowNoteEditor(false)
    setEditingNote(null)
    toast.success('Note updated successfully!')
  }

  const editNote = (note) => {
    setEditingNote(note)
    setCurrentNote(note.content)
    setNoteType(note.type)
    setShowNoteEditor(true)
  }

  const deleteNote = (noteId) => {
    setNotes(notes.filter(note => note.id !== noteId))
    toast.success('Note deleted!')
  }

  const saveWord = (word) => {
    if (savedWords.find(w => w.word === word.word)) {
      toast.info('Word already saved!')
      return
    }
    
    setSavedWords([...savedWords, word])
    
    // Update learning progress
    const updatedProgress = { ...learningProgress }
    updatedProgress.wordsLearned += 1
    updatedProgress.totalPoints += 5
    setLearningProgress(updatedProgress)
    
    toast.success(`"${word.word}" saved to vocabulary!`)
  }
  
  // Practice tab states
  const [selectedTest, setSelectedTest] = useState(null)
  const [currentQuestion, setCurrentQuestion] = useState(0)
  const [userAnswers, setUserAnswers] = useState({})
  const [showResults, setShowResults] = useState(false)
  const [testResults, setTestResults] = useState(null)

  // Transform practiceTests data to group by type
  const practiceTestCategories = useMemo(() => {
    const categories = {
      mini: {
        type: 'mini',
        description: 'Quick assessments to test specific skills',
        duration: '10-20 min',
        questions: '5-12 questions',
        tests: []
      },
      progress: {
        type: 'progress',
        description: 'Comprehensive tests to track your improvement',
        duration: '25-35 min',
        questions: '15-25 questions',
        tests: []
      },
      final: {
        type: 'final',
        description: 'Complete assessments for final evaluation',
        duration: '45-60 min',
        questions: '30-50 questions',
        tests: []
      }
    }

    practiceTests.forEach(test => {
      if (categories[test.type]) {
        categories[test.type].tests.push(test)
      }
    })

    return Object.values(categories)
  }, [])

  // Filter courses based on type
  const filteredCourses = useMemo(() => {
    if (courseFilter === 'all') return courses
    return courses.filter(course => course.type === courseFilter)
  }, [courseFilter])

  // Filter books based on multiple criteria
  const filteredBooks = useMemo(() => {
    return books.filter(book => {
      const matchesSearch = book.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                           book.author.toLowerCase().includes(searchTerm.toLowerCase())
      const matchesCategory = bookFilters.category === 'All Categories' || book.category === bookFilters.category
      const matchesLevel = bookFilters.level === 'All Levels' || book.level === bookFilters.level
      const matchesPrice = bookFilters.price === 'All' ||
                          (bookFilters.price === 'Free' && book.price === 0) ||
                          (bookFilters.price === 'Paid' && book.price > 0)
      const matchesProgress = bookFilters.progress === 'All' ||
                             (bookFilters.progress === 'Not Started' && book.progress === 0) ||
                             (bookFilters.progress === 'In Progress' && book.progress > 0 && book.progress < 100) ||
                             (bookFilters.progress === 'Completed' && book.progress === 100)
      const matchesOwned = bookFilters.owned === 'All' ||
                          (bookFilters.owned === 'Owned' && book.isOwned) ||
                          (bookFilters.owned === 'Not Owned' && !book.isOwned)

      return matchesSearch && matchesCategory && matchesLevel && matchesPrice && matchesProgress && matchesOwned
    })
  }, [books, bookFilters, searchTerm])

  const handleEnrollCourse = (courseId) => {
    // Navigate to course detail page
    navigate(`/student/course/${courseId}`)
  }

  const handleJoinClass = (classId) => {
    toast.success('Joining class...')
  }

  const handleBookAction = (book, action) => {
    switch (action) {
      case 'purchase':
        toast.success(`Purchased "${book.title}"!`)
        break
      case 'read':
        // Set selected book for reading
        const bookWithContent = {
          ...book,
          content: `This is the content of "${book.title}" by ${book.author}. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.`,
          totalPages: 150
        }
        setSelectedBook(bookWithContent)
        setCurrentPage(1)
        
        // Update learning progress
        const updatedProgress = { ...learningProgress }
        if (!book.progress || book.progress === 0) {
          updatedProgress.booksRead += 1
          updatedProgress.totalPoints += 50
          setLearningProgress(updatedProgress)
        }
        
        toast.success(`Opening "${book.title}" for reading`)
        break
      case 'bookmark':
        toast.success('Added to bookmarks!')
        break
      case 'sample':
        // Set selected book for sample reading
        const sampleBook = {
          ...book,
          content: `Sample content of "${book.title}" by ${book.author}. This is just a preview of the first few pages...`,
          totalPages: 10
        }
        setSelectedBook(sampleBook)
        setCurrentPage(1)
        toast.success(`Opening sample of "${book.title}"`)
        break
      default:
        break
    }
  }

  // Practice test handlers
  const handleStartTest = (test) => {
    setSelectedTest(test)
    setCurrentQuestion(0)
    setUserAnswers({})
    setShowResults(false)
    setTestResults(null)
    toast.success(`Starting ${test.title}...`)
  }

  const handleSubmitTest = () => {
    // Calculate results
    const totalQuestions = selectedTest.questions.length
    const answeredQuestions = Object.keys(userAnswers).length
    const correctAnswers = selectedTest.questions.filter((question, index) => {
      return userAnswers[index] === question.correctAnswer
    }).length
    
    const score = Math.round((correctAnswers / totalQuestions) * 100)
    const percentage = Math.round((correctAnswers / totalQuestions) * 100)
    const grade = score >= 90 ? 'Excellent' : score >= 80 ? 'Good' : score >= 70 ? 'Average' : 'Needs Improvement'
    
    const results = {
      score,
      percentage,
      grade,
      correct: correctAnswers,
      incorrect: answeredQuestions - correctAnswers,
      unanswered: totalQuestions - answeredQuestions,
      feedback: [
        score >= 80 ? 'Great job! You have a strong understanding of the material.' : 'Keep practicing to improve your understanding.',
        'Focus on areas where you made mistakes to strengthen your knowledge.',
        'Consider reviewing the study materials for topics you found challenging.',
        'Regular practice will help you achieve better scores in future tests.'
      ]
    }
    
    setTestResults(results)
    setShowResults(true)
    toast.success('Test submitted successfully!')
  }

  const renderStars = (rating) => {
    return Array.from({ length: 5 }, (_, i) => (
      <Star
        key={i}
        className={`w-4 h-4 ${i < Math.floor(rating) ? 'text-yellow-400 fill-current' : 'text-gray-300'}`}
      />
    ))
  }

  const renderCoursesTab = () => (
    <div className="space-y-6">
      {/* Course Filter Tabs */}
      <div className="flex flex-wrap gap-2 border-b border-gray-200 dark:border-gray-700">
        {[
          { key: 'all', label: 'All Courses', icon: BookOpen },
          { key: 'short', label: 'Short Courses', icon: Play },
          { key: 'group', label: 'Group Classes', icon: Users },
          { key: 'individual', label: '1-1 Classes', icon: User }
        ].map(({ key, label, icon: Icon }) => (
          <button
            key={key}
            onClick={() => setCourseFilter(key)}
            className={`flex items-center gap-2 px-4 py-2 border-b-2 transition-colors ${
              courseFilter === key
                ? 'border-blue-500 text-blue-600 dark:text-blue-400'
                : 'border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
            }`}
          >
            <Icon className="w-4 h-4" />
            {label}
          </button>
        ))}
      </div>

      {/* Video Lessons Section */}
      {!selectedVideo && (
        <div className="bg-white rounded-lg shadow p-6 mb-6">
          <h3 className="text-lg font-bold mb-4">Video Lessons</h3>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {videoLessons.map(video => (
              <div key={video.id} className="border border-gray-200 rounded-lg overflow-hidden hover:shadow-md transition-shadow">
                <div className="relative">
                  <img src={video.thumbnail} alt={video.title} className="w-full h-32 object-cover" />
                  <div className="absolute inset-0 bg-black/30 flex items-center justify-center">
                    <Play size={32} className="text-white" />
                  </div>
                  <div className="absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded">
                    {video.duration}
                  </div>
                </div>
                <div className="p-3">
                  <h4 className="font-medium text-sm mb-1">{video.title}</h4>
                  <p className="text-xs text-gray-600 line-clamp-2">{video.description}</p>
                  <div className="flex items-center justify-between mt-2">
                    <span className="text-xs text-gray-500">{video.level}</span>
                    {video.completed && (
                      <CheckCircle size={16} className="text-green-500" />
                    )}
                  </div>
                  <button
                    onClick={() => navigate(`/video/${video.id}`)}
                    className="w-full mt-3 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"
                  >
                    Xem bài giảng
                  </button>
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Courses Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {filteredCourses.map(course => (
          <div key={course.id} className="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
            <div className="relative">
              <img 
                src={course.thumbnail} 
                alt={course.title}
                className="w-full h-48 object-cover"
              />
              <div className="absolute top-2 left-2">
                <span className={`px-2 py-1 text-xs font-medium rounded-full ${
                  course.price === 0 
                    ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'
                    : 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200'
                }`}>
                  {course.price === 0 ? 'Free' : `$${course.price}`}
                </span>
              </div>
              {course.type === 'group' && (
                <div className="absolute top-2 right-2">
                  <span className="bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200 px-2 py-1 text-xs font-medium rounded-full">
                    Live Class
                  </span>
                </div>
              )}
            </div>
            
            <div className="p-4">
              <h3 className="font-semibold text-lg mb-2 text-gray-900 dark:text-white">
                {course.title}
              </h3>
              <p className="text-gray-600 dark:text-gray-400 text-sm mb-3 line-clamp-2">
                {course.description}
              </p>
              
              <div className="flex items-center gap-2 mb-3">
                <div className="flex items-center">
                  {renderStars(course.rating)}
                </div>
                <span className="text-sm text-gray-600 dark:text-gray-400">
                  {course.rating} ({course.students} students)
                </span>
              </div>

              <div className="flex items-center justify-between mb-4">
                <span className="text-sm text-gray-600 dark:text-gray-400">
                  By {course.instructor}
                </span>
                <div className="flex items-center gap-1 text-sm text-gray-600 dark:text-gray-400">
                  <Clock className="w-4 h-4" />
                  {course.duration}
                </div>
              </div>

              {course.type === 'group' && course.nextSession && (
                <div className="mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                  <div className="flex items-center gap-2 text-sm text-blue-700 dark:text-blue-300">
                    <Calendar className="w-4 h-4" />
                    Next: {course.nextSession.date} at {course.nextSession.time}
                  </div>
                </div>
              )}

              {course.type === 'individual' && course.nextSession && (
                <div className="mb-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                  <div className="flex items-center gap-2 text-sm text-green-700 dark:text-green-300">
                    <User className="w-4 h-4" />
                    Scheduled: {course.nextSession.date} at {course.nextSession.time}
                  </div>
                </div>
              )}

              <div className="flex gap-2">
                <button
                  onClick={() => navigate(`/student/course/${course.id}`)}
                  className="flex-1 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2"
                >
                  <Eye className="w-4 h-4" />
                  View Details
                </button>
                <button
                  onClick={() => handleEnrollCourse(course.id)}
                  className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2"
                >
                  {course.type === 'group' ? (
                    <>
                      <Users className="w-4 h-4" />
                      Join Class
                    </>
                  ) : course.type === 'individual' ? (
                    <>
                      <User className="w-4 h-4" />
                      Book Session
                    </>
                  ) : (
                    <>
                      <Play className="w-4 h-4" />
                      Enroll Now
                    </>
                  )}
                </button>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  )

  const renderBooksTab = () => (
    <div className="space-y-6">
      {/* My Library Section */}
      <div className="bg-gradient-to-r from-green-600 to-blue-600 rounded-lg p-6 text-white">
        <h2 className="text-2xl font-bold mb-2">My Digital Library</h2>
        <p className="text-green-100">
          Access your purchased books and reading materials
        </p>
      </div>

      {/* Quick Access to Owned Books */}
      <div className="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm">
        <h3 className="text-lg font-semibold mb-4 text-gray-900 dark:text-white">Recently Read</h3>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          {filteredBooks.filter(book => book.isOwned && book.progress > 0).slice(0, 4).map(book => (
            <div key={book.id} className="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-md transition-shadow">
              <img
                src={book.cover}
                alt={book.title}
                className="w-full h-32 object-cover rounded mb-3"
              />
              <h4 className="font-medium text-sm mb-1 text-gray-900 dark:text-white line-clamp-2">{book.title}</h4>
              <p className="text-xs text-gray-600 dark:text-gray-400 mb-2">{book.author}</p>
              <div className="mb-2">
                <div className="flex items-center justify-between text-xs mb-1">
                  <span className="text-gray-600 dark:text-gray-400">Progress</span>
                  <span className="text-gray-900 dark:text-white">{book.progress}%</span>
                </div>
                <div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-1">
                  <div 
                    className="bg-green-600 h-1 rounded-full transition-all duration-300"
                    style={{ width: `${book.progress}%` }}
                  />
                </div>
              </div>
              <button
                onClick={() => handleBookAction(book, 'read')}
                className="w-full bg-green-600 hover:bg-green-700 text-white py-1 px-2 rounded text-xs transition-colors flex items-center justify-center gap-1"
              >
                <BookOpen className="w-3 h-3" />
                Continue Reading
              </button>
            </div>
          ))}
        </div>
      </div>

      {/* Search and Filters */}
      <div className="flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between">
        <div className="flex-1 max-w-md">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
            <input
              type="text"
              placeholder="Search books..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
            />
          </div>
        </div>
        
        <div className="flex items-center gap-2">
          <button
            onClick={() => setViewMode(viewMode === 'grid' ? 'list' : 'grid')}
            className="p-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700"
          >
            {viewMode === 'grid' ? <List className="w-4 h-4" /> : <Grid className="w-4 h-4" />}
          </button>
        </div>
      </div>

      {/* Filter Row */}
      <div className="flex flex-wrap gap-4">
        <select
          value={bookFilters.category}
          onChange={(e) => setBookFilters(prev => ({ ...prev, category: e.target.value }))}
          className="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
        >
          {bookCategories.map(category => (
            <option key={category} value={category}>{category}</option>
          ))}
        </select>

        <select
          value={bookFilters.level}
          onChange={(e) => setBookFilters(prev => ({ ...prev, level: e.target.value }))}
          className="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
        >
          {bookLevels.map(level => (
            <option key={level} value={level}>{level}</option>
          ))}
        </select>

        <select
          value={bookFilters.price}
          onChange={(e) => setBookFilters(prev => ({ ...prev, price: e.target.value }))}
          className="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
        >
          {bookFilterOptions.price.map(price => (
            <option key={price} value={price}>{price}</option>
          ))}
        </select>

        <select
          value={bookFilters.progress}
          onChange={(e) => setBookFilters(prev => ({ ...prev, progress: e.target.value }))}
          className="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white"
        >
          {bookFilterOptions.progress.map(progress => (
            <option key={progress} value={progress}>{progress}</option>
          ))}
        </select>
      </div>

      {/* Books Grid/List */}
      <div className={viewMode === 'grid' 
        ? "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
        : "space-y-4"
      }>
        {filteredBooks.map(book => (
          <div key={book.id} className={`bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow ${
            viewMode === 'list' ? 'flex' : ''
          }`}>
            <div className={viewMode === 'list' ? 'w-32 flex-shrink-0' : ''}>
              <img 
                src={book.cover} 
                alt={book.title}
                className={`object-cover ${
                  viewMode === 'list' ? 'w-full h-full' : 'w-full h-48'
                }`}
              />
            </div>
            
            <div className="p-4 flex-1">
              <div className="flex items-start justify-between mb-2">
                <h3 className={`font-semibold text-gray-900 dark:text-white ${
                  viewMode === 'list' ? 'text-lg' : 'text-base'
                }`}>
                  {book.title}
                </h3>
                <button
                  onClick={() => handleBookAction(book, 'bookmark')}
                  className="text-gray-400 hover:text-red-500 transition-colors"
                >
                  <Heart className="w-4 h-4" />
                </button>
              </div>
              
              <p className="text-sm text-gray-600 dark:text-gray-400 mb-2">
                By {book.author}
              </p>
              
              <div className="flex items-center gap-2 mb-3">
                <div className="flex items-center">
                  {renderStars(book.rating)}
                </div>
                <span className="text-sm text-gray-600 dark:text-gray-400">
                  ({book.reviewCount})
                </span>
              </div>

              {book.progress > 0 && (
                <div className="mb-3">
                  <div className="flex items-center justify-between text-sm mb-1">
                    <span className="text-gray-600 dark:text-gray-400">Progress</span>
                    <span className="text-gray-900 dark:text-white">{book.progress}%</span>
                  </div>
                  <div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                    <div 
                      className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                      style={{ width: `${book.progress}%` }}
                    />
                  </div>
                </div>
              )}

              <div className="flex items-center justify-between">
                <div className="flex items-center gap-2">
                  {book.price === 0 ? (
                    <span className="text-green-600 dark:text-green-400 font-semibold">Free</span>
                  ) : (
                    <div className="flex items-center gap-1">
                      <span className="text-lg font-semibold text-gray-900 dark:text-white">
                        ${book.price}
                      </span>
                      {book.originalPrice && (
                        <span className="text-sm text-gray-500 line-through">
                          ${book.originalPrice}
                        </span>
                      )}
                    </div>
                  )}
                </div>

                <div className="flex items-center gap-2">
                  <button
                    onClick={() => navigate(`/student/book/${book.id}`)}
                    className="p-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
                    title="View Details"
                  >
                    <Eye className="w-4 h-4" />
                  </button>
                  <button
                    onClick={() => handleBookAction(book, 'sample')}
                    className="p-2 text-gray-600 dark:text-gray-400 hover:text-green-600 dark:hover:text-green-400 transition-colors"
                    title="Preview Sample"
                  >
                    <FileText className="w-4 h-4" />
                  </button>
                  
                  {book.isOwned ? (
                    <button
                      onClick={() => handleBookAction(book, 'read')}
                      className="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors flex items-center gap-1"
                    >
                      <BookOpen className="w-4 h-4" />
                      Read
                    </button>
                  ) : (
                    <button
                      onClick={() => handleBookAction(book, 'purchase')}
                      className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm transition-colors flex items-center gap-1"
                    >
                      <ShoppingCart className="w-4 h-4" />
                      Buy
                    </button>
                  )}
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  )

  const renderPracticeTab = () => {
    if (selectedTest && !showResults) {
      return renderTestInterface()
    }

    if (showResults && testResults) {
      return renderTestResults()
    }

    return (
      <div className="space-y-6">
        {/* Personalized Test List Header */}
        <div className="bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-6 text-white">
          <h2 className="text-2xl font-bold mb-2">Practice Tests</h2>
          <p className="text-blue-100">
            Personalized test sequence: Mini → Progress → Final
          </p>
        </div>

        {/* Test Categories */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {practiceTestCategories.map((testCategory) => (
            <div key={testCategory.type} className="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
              <div className={`p-4 ${
                testCategory.type === 'mini' ? 'bg-green-50 dark:bg-green-900/20' :
                testCategory.type === 'progress' ? 'bg-blue-50 dark:bg-blue-900/20' :
                'bg-purple-50 dark:bg-purple-900/20'
              }`}>
                <div className="flex items-center gap-3 mb-2">
                  {testCategory.type === 'mini' && <Timer className="w-6 h-6 text-green-600" />}
                  {testCategory.type === 'progress' && <TrendingUp className="w-6 h-6 text-blue-600" />}
                  {testCategory.type === 'final' && <Trophy className="w-6 h-6 text-purple-600" />}
                  <h3 className="text-lg font-semibold text-gray-900 dark:text-white capitalize">
                    {testCategory.type} Tests
                  </h3>
                </div>
                <p className="text-sm text-gray-600 dark:text-gray-400 mb-3">
                  {testCategory.description}
                </p>
                <div className="flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400">
                  <span className="flex items-center gap-1">
                    <Clock className="w-3 h-3" />
                    {testCategory.duration}
                  </span>
                  <span className="flex items-center gap-1">
                    <Target className="w-3 h-3" />
                    {testCategory.questions} questions
                  </span>
                </div>
              </div>

              <div className="p-4 space-y-3">
                {testCategory.tests.map((test) => (
                  <div key={test.id} className="flex items-center justify-between p-3 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                    <div className="flex-1">
                      <h4 className="font-medium text-gray-900 dark:text-white text-sm">
                        {test.title}
                      </h4>
                      <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">
                        {test.skill} • Level {test.level}
                      </p>
                      {test.completed && (
                        <div className="flex items-center gap-1 mt-1">
                          <CheckCircle className="w-3 h-3 text-green-500" />
                          <span className="text-xs text-green-600 dark:text-green-400">
                            Score: {test.lastScore}/100
                          </span>
                        </div>
                      )}
                    </div>
                    <button
                      onClick={() => handleStartTest(test)}
                      className={`px-3 py-1 rounded text-xs font-medium transition-colors ${
                        test.completed
                          ? 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600'
                          : testCategory.type === 'mini'
                          ? 'bg-green-600 hover:bg-green-700 text-white'
                          : testCategory.type === 'progress'
                          ? 'bg-blue-600 hover:bg-blue-700 text-white'
                          : 'bg-purple-600 hover:bg-purple-700 text-white'
                      }`}
                    >
                      {test.completed ? 'Retake' : 'Start'}
                    </button>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>

        {/* Progress Overview */}
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
          <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4">
            Your Progress
          </h3>
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div className="text-center">
              <div className="text-2xl font-bold text-green-600">12</div>
              <div className="text-sm text-gray-600 dark:text-gray-400">Mini Tests</div>
            </div>
            <div className="text-center">
              <div className="text-2xl font-bold text-blue-600">5</div>
              <div className="text-sm text-gray-600 dark:text-gray-400">Progress Tests</div>
            </div>
            <div className="text-center">
              <div className="text-2xl font-bold text-purple-600">2</div>
              <div className="text-sm text-gray-600 dark:text-gray-400">Final Tests</div>
            </div>
            <div className="text-center">
              <div className="text-2xl font-bold text-orange-600">78</div>
              <div className="text-sm text-gray-600 dark:text-gray-400">Avg Score</div>
            </div>
          </div>
        </div>
      </div>
    )
  }

  const renderTestInterface = () => {
    const question = selectedTest.questions[currentQuestion]
    const isLastQuestion = currentQuestion === selectedTest.questions.length - 1

    return (
      <div className="max-w-4xl mx-auto">
        {/* Test Header */}
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h2 className="text-xl font-bold text-gray-900 dark:text-white">
                {selectedTest.title}
              </h2>
              <p className="text-gray-600 dark:text-gray-400">
                {selectedTest.skill} • Level {selectedTest.level}
              </p>
            </div>
            <button
              onClick={() => {
                setSelectedTest(null)
                setCurrentQuestion(0)
                setUserAnswers({})
              }}
              className="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
            >
              ✕
            </button>
          </div>
          
          {/* Progress Bar */}
          <div className="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mb-4">
            <div 
              className="bg-blue-600 h-2 rounded-full transition-all duration-300"
              style={{ width: `${((currentQuestion + 1) / selectedTest.questions.length) * 100}%` }}
            />
          </div>
          
          <div className="flex justify-between text-sm text-gray-600 dark:text-gray-400">
            <span>Question {currentQuestion + 1} of {selectedTest.questions.length}</span>
            <span>Time: 15:30</span>
          </div>
        </div>

        {/* Question */}
        <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
          <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4">
            {question.question}
          </h3>
          
          {question.type === 'multiple-choice' && (
            <div className="space-y-3">
              {question.options.map((option, index) => (
                <label key={index} className="flex items-center p-3 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
                  <input
                    type="radio"
                    name={`question-${currentQuestion}`}
                    value={option}
                    checked={userAnswers[currentQuestion] === option}
                    onChange={(e) => setUserAnswers(prev => ({
                      ...prev,
                      [currentQuestion]: e.target.value
                    }))}
                    className="mr-3"
                  />
                  <span className="text-gray-900 dark:text-white">{option}</span>
                </label>
              ))}
            </div>
          )}

          {question.type === 'text' && (
            <textarea
              value={userAnswers[currentQuestion] || ''}
              onChange={(e) => setUserAnswers(prev => ({
                ...prev,
                [currentQuestion]: e.target.value
              }))}
              placeholder="Type your answer here..."
              className="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
              rows={4}
            />
          )}
        </div>

        {/* Navigation */}
        <div className="flex justify-between">
          <button
            onClick={() => setCurrentQuestion(prev => Math.max(0, prev - 1))}
            disabled={currentQuestion === 0}
            className="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Previous
          </button>
          
          {isLastQuestion ? (
            <button
              onClick={handleSubmitTest}
              className="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium"
            >
              Submit Test
            </button>
          ) : (
            <button
              onClick={() => setCurrentQuestion(prev => prev + 1)}
              className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg"
            >
              Next
            </button>
          )}
        </div>
      </div>
    )
  }

  const renderTestResults = () => (
    <div className="max-w-4xl mx-auto space-y-6">
      {/* Results Header */}
      <div className="bg-gradient-to-r from-green-600 to-blue-600 rounded-lg p-6 text-white text-center">
        <Trophy className="w-16 h-16 mx-auto mb-4" />
        <h2 className="text-2xl font-bold mb-2">Test Completed!</h2>
        <p className="text-green-100">
          {selectedTest.title} • {selectedTest.skill}
        </p>
      </div>

      {/* Score Overview */}
      <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <div className="text-center mb-6">
          <div className="text-4xl font-bold text-blue-600 mb-2">
            {testResults.score}/100
          </div>
          <div className="text-lg text-gray-600 dark:text-gray-400">
            {testResults.grade} • {testResults.percentage}% Correct
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
          <div>
            <div className="text-2xl font-bold text-green-600">
              {testResults.correct}
            </div>
            <div className="text-sm text-gray-600 dark:text-gray-400">Correct</div>
          </div>
          <div>
            <div className="text-2xl font-bold text-red-600">
              {testResults.incorrect}
            </div>
            <div className="text-sm text-gray-600 dark:text-gray-400">Incorrect</div>
          </div>
          <div>
            <div className="text-2xl font-bold text-gray-600">
              {testResults.unanswered}
            </div>
            <div className="text-sm text-gray-600 dark:text-gray-400">Unanswered</div>
          </div>
        </div>
      </div>

      {/* Feedback */}
      <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4">
          Feedback & Recommendations
        </h3>
        <div className="space-y-3">
          {testResults.feedback.map((item, index) => (
            <div key={index} className="flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
              <Lightbulb className="w-5 h-5 text-blue-600 mt-0.5" />
              <p className="text-gray-700 dark:text-gray-300 text-sm">{item}</p>
            </div>
          ))}
        </div>
      </div>

      {/* Actions */}
      <div className="flex gap-4 justify-center">
        <button
          onClick={() => {
            setShowResults(false)
            setSelectedTest(null)
            setCurrentQuestion(0)
            setUserAnswers({})
            setTestResults(null)
          }}
          className="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg"
        >
          Back to Tests
        </button>
        <button
          onClick={() => {
            setShowResults(false)
            setCurrentQuestion(0)
            setUserAnswers({})
            setTestResults(null)
          }}
          className="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg"
        >
          Retake Test
        </button>
      </div>
    </div>
  )

  const renderOthersTab = () => (
    <div className="space-y-6">
      {/* Connected Sites */}
      <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
          <Globe className="w-5 h-5" />
          Connected Sites
        </h3>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          {connectedSites.map((site) => (
            <a
              key={site.id}
              href={site.url}
              target="_blank"
              rel="noopener noreferrer"
              className="flex items-center gap-4 p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors group"
            >
              <div className={`w-12 h-12 rounded-lg flex items-center justify-center text-white font-bold text-lg ${site.color}`}>
                {site.name.charAt(0)}
              </div>
              <div className="flex-1">
                <h4 className="font-medium text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400">
                  {site.name}
                </h4>
                <p className="text-sm text-gray-600 dark:text-gray-400">
                  {site.description}
                </p>
              </div>
              <ExternalLink className="w-4 h-4 text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400" />
            </a>
          ))}
        </div>
      </div>

      {/* Study Tips */}
      <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
          <Lightbulb className="w-5 h-5" />
          Study Tips by Skill
        </h3>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {studyTips.map((tip) => (
            <div key={tip.id} className="p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:shadow-md transition-shadow">
              <div className="flex items-center gap-3 mb-3">
                {tip.skill === 'Speaking' && <MessageSquare className="w-6 h-6 text-blue-600" />}
                {tip.skill === 'Writing' && <PenTool className="w-6 h-6 text-green-600" />}
                {tip.skill === 'Reading' && <BookOpen className="w-6 h-6 text-purple-600" />}
                {tip.skill === 'Listening' && <Headphones className="w-6 h-6 text-orange-600" />}
                {tip.skill === 'Grammar' && <Brain className="w-6 h-6 text-red-600" />}
                {tip.skill === 'Vocabulary' && <Target className="w-6 h-6 text-indigo-600" />}
                <h4 className="font-medium text-gray-900 dark:text-white">
                  {tip.skill}
                </h4>
              </div>
              <h5 className="font-medium text-gray-800 dark:text-gray-200 mb-2 text-sm">
                {tip.title}
              </h5>
              <p className="text-sm text-gray-600 dark:text-gray-400 mb-3">
                {tip.description}
              </p>
              <div className="flex items-center justify-between">
                <span className={`px-2 py-1 rounded text-xs font-medium ${
                  tip.difficulty === 'Beginner' ? 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400' :
                  tip.difficulty === 'Intermediate' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400' :
                  'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400'
                }`}>
                  {tip.difficulty}
                </span>
                <span className="text-xs text-gray-500 dark:text-gray-400">
                  {tip.duration}
                </span>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Tutorials */}
      <div className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h3 className="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
          <Youtube className="w-5 h-5 text-red-600" />
          Video Tutorials
        </h3>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {tutorials.map((tutorial) => (
            <div key={tutorial.id} className="group cursor-pointer">
              <div className="relative bg-gray-100 dark:bg-gray-700 rounded-lg overflow-hidden mb-3 aspect-video">
                <img
                  src={tutorial.thumbnail}
                  alt={tutorial.title}
                  className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                />
                <div className="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                  <Play className="w-12 h-12 text-white" />
                </div>
                <div className="absolute bottom-2 right-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded">
                  {tutorial.duration}
                </div>
              </div>
              <h4 className="font-medium text-gray-900 dark:text-white mb-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">
                {tutorial.title}
              </h4>
              <p className="text-sm text-gray-600 dark:text-gray-400 mb-2">
                {tutorial.description}
              </p>
              <div className="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
                <span>{tutorial.instructor}</span>
                <div className="flex items-center gap-3">
                  <span className="flex items-center gap-1">
                    <Eye className="w-3 h-3" />
                    {tutorial.views}
                  </span>
                  <span className="flex items-center gap-1">
                    <Star className="w-3 h-3" />
                    {tutorial.rating}
                  </span>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  )

  // Video Player Component
  const VideoPlayer = ({ video }) => {
    if (!video) return null

    return (
      <div className="bg-white rounded-lg shadow-lg overflow-hidden mb-6">
        <div className="relative">
          <video
            ref={videoRef}
            src={video.videoUrl}
            className="w-full h-64 md:h-96 object-cover"
            onTimeUpdate={handleVideoTimeUpdate}
            onLoadedMetadata={handleVideoLoadedMetadata}
            onPlay={() => setIsPlaying(true)}
            onPause={() => setIsPlaying(false)}
            onMouseEnter={() => setShowControls(true)}
            onMouseLeave={() => setShowControls(false)}
          />
          
          {/* Video Controls */}
          <div className={`absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 transition-opacity ${showControls ? 'opacity-100' : 'opacity-0'}`}>
            {/* Progress Bar */}
            <div className="mb-4">
              <input
                type="range"
                min="0"
                max={duration || 0}
                value={currentTime}
                onChange={(e) => handleSeek(parseFloat(e.target.value))}
                className="w-full h-1 bg-gray-300 rounded-lg appearance-none cursor-pointer slider"
                style={{
                  background: `linear-gradient(to right, #3b82f6 0%, #3b82f6 ${(currentTime / duration) * 100}%, #d1d5db ${(currentTime / duration) * 100}%, #d1d5db 100%)`
                }}
              />
            </div>
            
            {/* Control Buttons */}
            <div className="flex items-center justify-between text-white">
              <div className="flex items-center space-x-4">
                <button onClick={handleSkipBackward} className="hover:text-blue-400 transition-colors">
                  <Rewind size={20} />
                </button>
                <button onClick={handleVideoPlay} className="hover:text-blue-400 transition-colors">
                  {isPlaying ? <Pause size={24} /> : <Play size={24} />}
                </button>
                <button onClick={handleSkipForward} className="hover:text-blue-400 transition-colors">
                  <FastForward size={20} />
                </button>
                <div className="flex items-center space-x-2">
                  <button onClick={() => handleVolumeChange(volume === 0 ? 1 : 0)} className="hover:text-blue-400 transition-colors">
                    {volume === 0 ? <VolumeX size={20} /> : <Volume2 size={20} />}
                  </button>
                  <input
                    type="range"
                    min="0"
                    max="1"
                    step="0.1"
                    value={volume}
                    onChange={(e) => handleVolumeChange(parseFloat(e.target.value))}
                    className="w-16 h-1 bg-gray-300 rounded-lg appearance-none cursor-pointer"
                  />
                </div>
              </div>
              
              <div className="flex items-center space-x-4">
                <span className="text-sm font-mono">
                  {formatTime(currentTime)} / {formatTime(duration)}
                </span>
                <select
                  value={playbackRate}
                  onChange={(e) => handlePlaybackRateChange(parseFloat(e.target.value))}
                  className="bg-black/50 text-white text-sm rounded px-2 py-1 border border-gray-600"
                >
                  <option value={0.5}>0.5x</option>
                  <option value={0.75}>0.75x</option>
                  <option value={1}>1x</option>
                  <option value={1.25}>1.25x</option>
                  <option value={1.5}>1.5x</option>
                  <option value={2}>2x</option>
                </select>
                <button 
                  onClick={() => setShowSubtitles(!showSubtitles)} 
                  className={`hover:text-blue-400 transition-colors ${showSubtitles ? 'text-blue-400' : ''}`}
                >
                  <Subtitles size={20} />
                </button>
                <button onClick={toggleFullscreen} className="hover:text-blue-400 transition-colors">
                  <Maximize size={20} />
                </button>
              </div>
            </div>
          </div>
          
          {/* Subtitles */}
          {showSubtitles && video.subtitles && (
            <div className="absolute bottom-16 left-0 right-0 text-center">
              {video.subtitles
                .filter(sub => currentTime >= sub.start && currentTime <= sub.end)
                .map((sub, index) => (
                  <div key={index} className="bg-black/70 text-white px-4 py-2 rounded mx-4 text-lg font-medium">
                    {sub.text}
                  </div>
                ))
              }
            </div>
          )}
        </div>
        
        {/* Video Info */}
        <div className="p-6">
          <div className="flex items-start justify-between mb-4">
            <div>
              <h3 className="text-xl font-bold mb-2">{video.title}</h3>
              <p className="text-gray-600 mb-2">{video.description}</p>
              <div className="flex items-center space-x-4 text-sm text-gray-500">
                <span className="flex items-center space-x-1">
                  <Clock size={16} />
                  <span>{video.duration}</span>
                </span>
                {video.completed && (
                  <span className="flex items-center space-x-1 text-green-600">
                    <CheckCircle size={16} />
                    <span>Completed</span>
                  </span>
                )}
              </div>
            </div>
          </div>
          
          {/* Action Buttons */}
          <div className="flex flex-wrap items-center gap-3">
            <button
              onClick={addTimestampedNote}
              className="flex items-center space-x-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors"
            >
              <PenTool size={16} />
              <span>Add Note</span>
            </button>
            <button
              onClick={() => setShowVocabularyPanel(!showVocabularyPanel)}
              className="flex items-center space-x-2 bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors"
            >
              <Languages size={16} />
              <span>Vocabulary</span>
            </button>
            <button
              onClick={() => {
                const updatedProgress = { ...learningProgress }
                if (!video.completed) {
                  updatedProgress.videosWatched += 1
                  setLearningProgress(updatedProgress)
                  toast.success('Video marked as completed!')
                }
              }}
              className="flex items-center space-x-2 bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors"
            >
              <Trophy size={16} />
              <span>Mark Complete</span>
            </button>
          </div>
        </div>
      </div>
    )
  }

  // Note Editor Component
  const NoteEditor = () => {
    if (!showNoteEditor) return null

    return (
      <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div className="bg-white rounded-lg p-6 w-full max-w-2xl mx-4">
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-lg font-bold">
              {editingNote ? 'Edit Note' : 'Add New Note'}
            </h3>
            <button
              onClick={() => {
                setShowNoteEditor(false)
                setCurrentNote('')
                setEditingNote(null)
              }}
              className="text-gray-500 hover:text-gray-700"
            >
              ×
            </button>
          </div>
          
          {selectedVideo && (
            <div className="mb-4 p-3 bg-blue-50 rounded-lg">
              <div className="flex items-center space-x-2 text-sm text-blue-600">
                <Video size={16} />
                <span>{selectedVideo.title}</span>
                <span>•</span>
                <span>{formatTime(noteTimestamp)}</span>
              </div>
            </div>
          )}
          
          <div className="mb-4">
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Note Type
            </label>
            <select
              value={noteType}
              onChange={(e) => setNoteType(e.target.value)}
              className="w-full p-2 border border-gray-300 rounded-lg"
            >
              <option value="text">Text Note</option>
              <option value="highlight">Highlight</option>
              <option value="bookmark">Bookmark</option>
            </select>
          </div>
          
          <div className="mb-6">
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Note Content
            </label>
            <textarea
              value={currentNote}
              onChange={(e) => setCurrentNote(e.target.value)}
              placeholder="Enter your note here..."
              className="w-full p-3 border border-gray-300 rounded-lg h-32 resize-none"
            />
          </div>
          
          <div className="flex items-center justify-end space-x-3">
            <button
              onClick={() => {
                setShowNoteEditor(false)
                setCurrentNote('')
                setEditingNote(null)
              }}
              className="px-4 py-2 text-gray-600 hover:text-gray-800"
            >
              Cancel
            </button>
            <button
              onClick={editingNote ? updateNote : addNote}
              className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
            >
              {editingNote ? 'Update Note' : 'Save Note'}
            </button>
          </div>
        </div>
      </div>
    )
  }

  // Notes List Component
  const NotesList = () => {
    const currentNotes = notes.filter(note => 
      selectedVideo ? note.videoId === selectedVideo.id : 
      selectedBook ? note.bookId === selectedBook.id : true
    )

    if (currentNotes.length === 0) {
      return (
        <div className="bg-white rounded-lg shadow p-6">
          <h3 className="text-lg font-bold mb-4">Notes</h3>
          <div className="text-center text-gray-500 py-8">
            <FileText size={48} className="mx-auto mb-4 text-gray-300" />
            <p>No notes yet. Start taking notes while learning!</p>
          </div>
        </div>
      )
    }

    return (
      <div className="bg-white rounded-lg shadow p-6">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-bold">Notes ({currentNotes.length})</h3>
          <button
            onClick={() => setShowNoteEditor(true)}
            className="flex items-center space-x-2 bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600 text-sm"
          >
            <Plus size={16} />
            <span>Add Note</span>
          </button>
        </div>
        
        <div className="space-y-3">
          {currentNotes.map(note => (
            <div key={note.id} className="border border-gray-200 rounded-lg p-4">
              <div className="flex items-start justify-between mb-2">
                <div className="flex items-center space-x-2">
                  {note.type === 'highlight' && <Highlighter size={16} className="text-yellow-500" />}
                  {note.type === 'bookmark' && <Bookmark size={16} className="text-blue-500" />}
                  {note.type === 'text' && <FileText size={16} className="text-gray-500" />}
                  <span className="text-sm text-gray-500">
                    {new Date(note.createdAt).toLocaleDateString()}
                  </span>
                  {note.timestamp && (
                    <>
                      <span className="text-gray-300">•</span>
                      <button
                        onClick={() => jumpToTimestamp(note.timestamp)}
                        className="text-sm text-blue-500 hover:text-blue-700"
                      >
                        {formatTime(note.timestamp)}
                      </button>
                    </>
                  )}
                </div>
                <div className="flex items-center space-x-2">
                  <button
                    onClick={() => editNote(note)}
                    className="text-gray-400 hover:text-blue-500"
                  >
                    <Edit3 size={16} />
                  </button>
                  <button
                    onClick={() => deleteNote(note.id)}
                    className="text-gray-400 hover:text-red-500"
                  >
                    <Trash2 size={16} />
                  </button>
                </div>
              </div>
              <p className="text-gray-700">{note.content}</p>
            </div>
          ))}
        </div>
      </div>
    )
  }

  // Vocabulary Panel Component
  const VocabularyPanel = () => {
    if (!showVocabularyPanel) return null

    return (
      <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
        <div className="flex items-center justify-between mb-4">
          <h3 className="text-lg font-bold">Vocabulary Helper</h3>
          <button
            onClick={() => setShowVocabularyPanel(false)}
            className="text-gray-500 hover:text-gray-700"
          >
            ×
          </button>
        </div>
        
        {/* Search Input */}
        <div className="mb-4">
          <div className="relative">
            <Search size={20} className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" />
            <input
              type="text"
              value={vocabularySearch}
              onChange={(e) => setVocabularySearch(e.target.value)}
              placeholder="Search for words..."
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg"
            />
          </div>
        </div>
        
        {/* Search Results */}
        {vocabularyResults.length > 0 && (
          <div className="mb-6">
            <h4 className="font-medium mb-3">Search Results</h4>
            <div className="space-y-3">
              {vocabularyResults.map((word, index) => (
                <div key={index} className="border border-gray-200 rounded-lg p-4">
                  <div className="flex items-start justify-between mb-2">
                    <div>
                      <h5 className="font-bold text-lg">{word.word}</h5>
                      <p className="text-sm text-gray-500">{word.pronunciation}</p>
                      <span className="inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mt-1">
                        {word.level}
                      </span>
                    </div>
                    <button
                      onClick={() => saveWord(word)}
                      className="flex items-center space-x-1 bg-green-500 text-white px-3 py-1 rounded-lg hover:bg-green-600 text-sm"
                    >
                      <BookmarkPlus size={16} />
                      <span>Save</span>
                    </button>
                  </div>
                  <p className="text-gray-700 mb-2">{word.definition}</p>
                  {word.examples && (
                    <div className="mb-2">
                      <p className="text-sm font-medium text-gray-600">Examples:</p>
                      <ul className="text-sm text-gray-600 ml-4">
                        {word.examples.map((example, i) => (
                          <li key={i} className="list-disc">{example}</li>
                        ))}
                      </ul>
                    </div>
                  )}
                  {word.synonyms && word.synonyms.length > 0 && (
                    <div>
                      <span className="text-sm font-medium text-gray-600">Synonyms: </span>
                      <span className="text-sm text-gray-600">{word.synonyms.join(', ')}</span>
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        )}
        
        {/* Saved Words */}
        {savedWords.length > 0 && (
          <div>
            <h4 className="font-medium mb-3">Saved Words ({savedWords.length})</h4>
            <div className="space-y-2 max-h-64 overflow-y-auto">
              {savedWords.map((word, index) => (
                <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                  <div>
                    <span className="font-medium">{word.word}</span>
                    <p className="text-sm text-gray-600 truncate">{word.definition}</p>
                  </div>
                  <button
                    onClick={() => removeWord(word.word)}
                    className="text-red-500 hover:text-red-700"
                  >
                    <Trash2 size={16} />
                  </button>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    )
  }

  // Book Reader Component
  const BookReader = ({ book }) => {
    if (!book) return null

    return (
      <div className="bg-white rounded-lg shadow-lg overflow-hidden mb-6">
        <div className="p-6 border-b border-gray-200">
          <div className="flex items-center justify-between mb-4">
            <div>
              <h3 className="text-xl font-bold mb-2">{book.title}</h3>
              <p className="text-gray-600">by {book.author}</p>
            </div>
            <div className="flex items-center space-x-3">
              <select
                value={fontSize}
                onChange={(e) => setFontSize(e.target.value)}
                className="px-3 py-1 border border-gray-300 rounded-lg text-sm"
              >
                <option value="small">Small</option>
                <option value="medium">Medium</option>
                <option value="large">Large</option>
              </select>
              <select
                value={theme}
                onChange={(e) => setTheme(e.target.value)}
                className="px-3 py-1 border border-gray-300 rounded-lg text-sm"
              >
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="sepia">Sepia</option>
              </select>
              <button
                onClick={() => setShowVocabularyPanel(!showVocabularyPanel)}
                className="flex items-center space-x-2 bg-green-500 text-white px-3 py-1 rounded-lg hover:bg-green-600 text-sm"
              >
                <Languages size={16} />
                <span>Dictionary</span>
              </button>
            </div>
          </div>
          
          {/* Reading Progress */}
          <div className="mb-4">
            <div className="flex items-center justify-between text-sm text-gray-600 mb-2">
              <span>Page {currentPage} of {book.totalPages}</span>
              <span>{Math.round((currentPage / book.totalPages) * 100)}% complete</span>
            </div>
            <div className="w-full bg-gray-200 rounded-full h-2">
              <div 
                className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                style={{ width: `${(currentPage / book.totalPages) * 100}%` }}
              ></div>
            </div>
          </div>
        </div>
        
        {/* Book Content */}
        <div className={`p-8 ${
          theme === 'dark' ? 'bg-gray-800 text-white' : 
          theme === 'sepia' ? 'bg-yellow-50 text-gray-800' : 
          'bg-white text-gray-900'
        } ${
          fontSize === 'small' ? 'text-sm' : 
          fontSize === 'large' ? 'text-lg' : 
          'text-base'
        } leading-relaxed`}>
          <div 
            className="prose max-w-none"
            onMouseUp={() => {
              const selection = window.getSelection()
              if (selection.toString().trim()) {
                setSelectedWord(selection.toString().trim())
                setVocabularySearch(selection.toString().trim())
              }
            }}
          >
            {book.content}
          </div>
        </div>
        
        {/* Navigation Controls */}
        <div className="p-6 border-t border-gray-200 flex items-center justify-between">
          <button
            onClick={() => setCurrentPage(Math.max(1, currentPage - 1))}
            disabled={currentPage === 1}
            className="flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <ChevronLeft size={16} />
            <span>Previous</span>
          </button>
          
          <div className="flex items-center space-x-4">
            <button
              onClick={() => addBookmark(currentPage)}
              className="flex items-center space-x-2 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"
            >
              <Bookmark size={16} />
              <span>Bookmark</span>
            </button>
            <button
              onClick={() => setShowNoteEditor(true)}
              className="flex items-center space-x-2 bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600"
            >
              <PenTool size={16} />
              <span>Add Note</span>
            </button>
          </div>
          
          <button
            onClick={() => setCurrentPage(Math.min(book.totalPages, currentPage + 1))}
            disabled={currentPage === book.totalPages}
            className="flex items-center space-x-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span>Next</span>
            <ChevronRight size={16} />
          </button>
        </div>
        
        {/* Bookmarks */}
        {bookmarks.length > 0 && (
          <div className="p-6 border-t border-gray-200">
            <h4 className="font-medium mb-3">Bookmarks</h4>
            <div className="flex flex-wrap gap-2">
              {bookmarks.map((bookmark, index) => (
                <button
                  key={index}
                  onClick={() => setCurrentPage(bookmark.page)}
                  className="flex items-center space-x-2 bg-blue-100 text-blue-800 px-3 py-1 rounded-lg hover:bg-blue-200 text-sm"
                >
                  <Bookmark size={14} />
                  <span>Page {bookmark.page}</span>
                  <button
                    onClick={(e) => {
                      e.stopPropagation()
                      removeBookmark(bookmark.page)
                    }}
                    className="text-blue-600 hover:text-blue-800"
                  >
                    ×
                  </button>
                </button>
              ))}
            </div>
          </div>
        )}
      </div>
    )
  }

  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-900">
      <div className="max-w-7xl mx-auto px-4 py-8">
        {/* Learning Progress Dashboard */}
        <div className="mb-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 text-white">
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-bold">Your Learning Progress</h2>
            <div className="flex items-center space-x-2">
              <Trophy size={20} />
              <span className="font-medium">Level {Math.floor(learningProgress.totalPoints / 1000) + 1}</span>
            </div>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div className="bg-white/20 rounded-lg p-4">
              <div className="flex items-center space-x-2 mb-2">
                <Video size={16} />
                <span className="text-sm font-medium">Videos Watched</span>
              </div>
              <p className="text-2xl font-bold">{learningProgress.videosWatched}</p>
            </div>
            <div className="bg-white/20 rounded-lg p-4">
              <div className="flex items-center space-x-2 mb-2">
                <BookOpen size={16} />
                <span className="text-sm font-medium">Books Read</span>
              </div>
              <p className="text-2xl font-bold">{learningProgress.booksRead}</p>
            </div>
            <div className="bg-white/20 rounded-lg p-4">
              <div className="flex items-center space-x-2 mb-2">
                <FileText size={16} />
                <span className="text-sm font-medium">Notes Taken</span>
              </div>
              <p className="text-2xl font-bold">{learningProgress.notesTaken}</p>
            </div>
            <div className="bg-white/20 rounded-lg p-4">
              <div className="flex items-center space-x-2 mb-2">
                <Languages size={16} />
                <span className="text-sm font-medium">Words Learned</span>
              </div>
              <p className="text-2xl font-bold">{learningProgress.wordsLearned}</p>
            </div>
          </div>
          
          <div className="mt-4">
            <div className="flex items-center justify-between text-sm mb-2">
              <span>Daily Streak: {learningProgress.dailyStreak} days</span>
              <span>{learningProgress.totalPoints} / {learningProgress.weeklyGoal} points this week</span>
            </div>
            <div className="w-full bg-white/20 rounded-full h-2">
              <div 
                className="bg-white h-2 rounded-full transition-all duration-300"
                style={{ width: `${Math.min((learningProgress.totalPoints / learningProgress.weeklyGoal) * 100, 100)}%` }}
              ></div>
            </div>
          </div>
        </div>

        {/* Header */}
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            Learning Materials
          </h1>
          <p className="text-gray-600 dark:text-gray-400">
            Explore courses, books, and practice materials to enhance your English learning journey.
          </p>
        </div>

        {/* Tab Navigation */}
        <div className="flex flex-wrap gap-1 mb-8 bg-white dark:bg-gray-800 p-1 rounded-lg shadow-sm">
          {[
            { key: 'courses', label: 'Courses', icon: BookOpen },
            { key: 'books', label: 'Books', icon: FileText },
            { key: 'practice', label: 'Practice', icon: Target },
            { key: 'others', label: 'Others', icon: Zap }
          ].map(({ key, label, icon: Icon }) => (
            <button
              key={key}
              onClick={() => setActiveTab(key)}
              className={`flex items-center gap-2 px-4 py-2 rounded-md transition-colors ${
                activeTab === key
                  ? 'bg-blue-600 text-white'
                  : 'text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200'
              }`}
            >
              <Icon className="w-4 h-4" />
              {label}
            </button>
          ))}
        </div>

        {/* Tab Content */}
        <div>
          {activeTab === 'courses' && (
            <div className="space-y-6">
              {/* Video Player */}
              {selectedVideo && <VideoPlayer video={selectedVideo} />}
              
              {/* Vocabulary Panel */}
              <VocabularyPanel />
              
              {/* Note Editor Modal */}
              <NoteEditor />
              
              {/* Main Content */}
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div className="lg:col-span-2">
                  {renderCoursesTab()}
                </div>
                <div className="space-y-6">
                  <NotesList />
                </div>
              </div>
            </div>
          )}
          
          {activeTab === 'books' && (
            <div className="space-y-6">
              {/* Book Reader */}
              {selectedBook && <BookReader book={selectedBook} />}
              
              {/* Vocabulary Panel */}
              <VocabularyPanel />
              
              {/* Note Editor Modal */}
              <NoteEditor />
              
              {/* Main Content */}
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div className="lg:col-span-2">
                  {renderBooksTab()}
                </div>
                <div className="space-y-6">
                  <NotesList />
                </div>
              </div>
            </div>
          )}
          
          {activeTab === 'practice' && renderPracticeTab()}
          {activeTab === 'others' && renderOthersTab()}
        </div>
      </div>
    </div>
  )
}

export { videoLessons }
export default Materials